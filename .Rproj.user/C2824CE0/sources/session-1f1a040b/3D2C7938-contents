pdcor <- function (x, y, z) {
  if ( is.vector(x) & is.vector(y) & is.vector(z) ) {
    a1 <- dcov::dcor(x, y, type = "U")
    a2 <- Rfast::dcor(x, z, bc = TRUE)$dcor
    a3 <- Rfast::dcor(y, z, bc = TRUE)$dcor
    r <- up <- a1 - a2 * a3
    down <- sqrt(1 - a2^2) * sqrt(1 - a3^2)
    r <- up/down
  } else r <- Rfast::pdcor(x, y, z)
  r
}

